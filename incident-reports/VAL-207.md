# Incident Report: VAL-207 – Routing Number Optional

## Summary
- Reporter: Support Team  
- Priority: High  
- Description: Users could submit bank funding requests without entering a routing number. The client-side validation was easy to bypass (field unmounted after toggling sources), and the backend didn’t trim/validate the routing number strictly.

## Impact
- ACH transfers failed because submitted payloads lacked routing numbers, driving support volume and delaying customer deposits.

## Detection
- Multiple failed ACH transfers surfaced in support logs. Reproduced by selecting “Bank Account”, leaving the routing field blank, and toggling inputs to force submission.

## Root Cause
1. The routing number field only used HTML `required`/pattern rules, which could be bypassed when the field unmounted.
2. The API accepted routing numbers verbatim without trimming whitespace, and payloads with missing routing numbers sometimes slipped through.

## Resolution
- Frontend (`components/FundingModal.tsx`):
  - Added custom validation that ensures routing numbers are present and exactly 9 digits whenever “Bank” is selected, regardless of field mounting state.
  - When submitting a card funding request, the form now strips the routing number to prevent stale data from reaching the backend.
- Backend (`server/routers/account.ts`):
  - Updated the Zod schema to trim routing numbers and continue enforcing the 9-digit requirement so requests that bypass the UI are rejected.

## Verification
- Manual reasoning/tests: Attempting to submit a bank transfer without a routing number now surfaces an error on the form, and API calls missing the field are rejected before reaching business logic. Valid nine-digit routing numbers pass normally.

## Lessons Learned
1. Conditional form fields should use custom validation tied to business state, not just HTML attributes.
2. Backend schemas must sanitize and validate critical banking fields even if the UI claims to enforce them.
3. Include ACH validation paths in automated regression suites to catch these regressions early.
