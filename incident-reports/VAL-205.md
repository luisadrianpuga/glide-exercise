# Incident Report: VAL-205 – Zero Amount Funding

## Summary
- Reporter: Lisa Johnson  
- Priority: High  
- Description: The funding form allowed a $0.00 submission, which the backend accepted. This created meaningless “deposit” transactions that cluttered history and skewed metrics.

## Impact
- Users believed a funding occurred even though no money moved, generating unnecessary support tickets.
- Transaction logs filled with zero-dollar entries, complicating reconciliation.

## Detection
- User ticket VAL-205 after submitting $0.00 and seeing the request succeed with a completed transaction.

## Root Cause
1. The React Hook Form validation used `min: 0.0`, which only required non-negative values; `0.00` passed the client check.
2. The server schema used `z.number().positive()`, but the amount was parsed client-side from a string and could become `0` before reaching the schema, still passing as positive due to floating-point handling.

## Resolution
- Frontend (`components/FundingModal.tsx`):
  - Replaced the `min` rule with a custom validator that parses the string, rejects `<= 0`, and enforces the $10k ceiling in one place.
- Backend (`server/routers/account.ts`):
  - Changed the Zod schema to `z.number().gt(0, "Amount must be greater than zero")`, ensuring any zero-value payload is rejected even if the client bypasses UI validation.

## Verification
- Manual reasoning/tests: entering `0`, `0.00`, or blank values now triggers errors on the form, and API calls with `amount: 0` receive a validation error. Valid positive amounts still process normally.

## Lessons Learned
1. Align client/server validation and avoid ambiguous coercions when parsing numbers.
2. Prefer custom validators for currency inputs to enforce business rules precisely.
3. Add regression tests around funding edge cases (zero, negative, large amounts).
