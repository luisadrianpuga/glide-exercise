# Incident Report: SEC-302 â€“ Insecure Random Numbers

## Summary
- Reporter: Security Team  
- Priority: High  
- Description: Account numbers were generated using `Math.random()`, which is predictable and not suitable for security-sensitive identifiers.

## Impact
- Attackers could potentially guess or brute-force account numbers.
- Regulatory/compliance concerns for non-random account identifiers.

## Detection
- Security review flagged the use of `Math.random()` in `server/routers/account.ts` (function `generateAccountNumber`).

## Root Cause
1. The original implementation relied on `Math.random()` * 1,000,000,000, producing predictable sequences.
2. No secure RNG (crypto module) was used, so account numbers had low entropy.

## Resolution
- Updated `generateAccountNumber` to use `crypto.randomInt(0, 1_000_000_000)` and pad to 10 digits.
- Keeps uniqueness checks but now leverages Node's cryptographically secure RNG.

## Verification
- Manual reasoning: `crypto.randomInt` uses `randomBytes` under the hood, providing strong randomness. Generated numbers remain 10 digits.
- Additional manual tests show account creation still succeeds and numbers remain unique.

## Lessons Learned
1. Avoid `Math.random` for IDs or secrets; use `crypto` APIs instead.
2. Include secure RNG requirement in coding standards.
3. Consider integrating automated lint/rules to flag insecure randomness usage.
