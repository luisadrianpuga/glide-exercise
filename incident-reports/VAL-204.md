# Incident Report: VAL-204 – Phone Number Format

## Summary
- Reporter: John Smith  
- Priority: Medium  
- Description: Signup accepted any numeric string as a phone number, rejecting neither short/long inputs nor missing country codes. International customers were often unreachable.

## Impact
- Support could not contact users for account notifications or security follow-up.
- Invalid phone data entered the CRM, causing operational delays.

## Detection
- Customer ticket VAL-204 highlighted that strings like "123" or random digits passed validation; no enforcement of E.164-style formatting existed.

## Root Cause
1. Frontend validation only enforced exactly 10 digits, assuming U.S.-only numbers.
2. Backend schema mirrored this weak regex (`^\+?\d{10,15}$`), allowing arbitrary lengths and missing the international dialing rules.

## Resolution
- Added `lib/validation/phone.ts` with `validateInternationalPhone`, enforcing a normalized international format (leading "+" optional, 8–15 digits, no leading zeros, whitespace stripped).
- Updated the signup form to use this helper so React Hook Form surfaces clear errors for invalid numbers and suggests the E.164 example.
- Updated the auth router to reuse the helper via Zod `superRefine`, trimming whitespace and guaranteeing consistent validation server-side.

## Verification
- Manual tests show invalid values (e.g., `123`, `00000000`, `++++`) now produce errors, while valid international numbers like `+14155552671` succeed on both client and server.

## Lessons Learned
1. Treat phone numbers as international by default; avoid hardcoding 10-digit assumptions.
2. Share validation helpers between frontend and backend to prevent discrepancies.
3. Provide users with placeholder examples to guide input format.
