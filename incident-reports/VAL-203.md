# Incident Report: VAL-203 – State Code Validation

## Summary
- Reporter: Alex Thompson  
- Priority: Medium  
- Description: Signup accepted invalid state codes such as "XX", causing incorrect addresses.

## Impact
- Downstream banking communications were misrouted or failed because addresses contained invalid state abbreviations.

## Detection
- Customer ticket VAL-203 reported that entering "XX" in the State field passed validation and allowed account creation.

## Root Cause
1. Frontend validation only enforced a 2-letter pattern (`^[A-Z]{2}$`) without checking against the actual list of U.S. states.
2. Backend schema mirrored this weak validation, so API calls with arbitrary two-letter combos succeeded.

## Resolution
- Created `lib/validation/state.ts` defining the canonical list of U.S. state/territory codes and helpers (`getStateValidationError`).
- Updated the signup form to call this helper via React Hook Form, producing descriptive errors when a non-state code is entered.
- Updated the auth router’s Zod schema to use the same helper and normalize values to uppercase, ensuring direct API usage is also validated.

## Verification
- Manual tests show invalid codes ("XX", "ZZ") now display "Enter a valid U.S. state code" on the form, and API submissions return validation errors. Valid codes continue to succeed.

## Lessons Learned
1. Pattern-based validation is insufficient for constrained enumerations—use explicit allowlists.
2. Share validation helpers between frontend and backend to prevent drift.
3. Document state/region requirements for future internationalization work.
