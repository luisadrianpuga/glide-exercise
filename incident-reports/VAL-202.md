# Incident Report: VAL-202 â€“ Date of Birth Validation

## Summary
- Reporter: Maria Garcia  
- Priority: Critical  
- Description: During signup, the form accepted a birth date in the year 2025. Accepting future birth dates allows minors (or invalid identities) to onboard, creating compliance exposure.

## Impact
- Potential violation of KYC/AML policies by allowing underage or fraudulent accounts.
- Downstream banking workflows (e.g., funding, card issuance) could activate for ineligible customers.

## Detection
- Discovered via customer ticket VAL-202 after a manual test in the signup flow.

## Root Cause
1. The Next.js signup form only enforced that `dateOfBirth` field was present; it did not prevent future dates or ensure the user is an adult.
2. The `auth.signup` TRPC endpoint validated `dateOfBirth` as a plain string, so API clients could bypass any client-side guard.

## Resolution
- Added a shared `MINIMUM_SIGNUP_AGE` constant (currently 18 years) and helper `calculateAge`/`validateDateOfBirth` on the front end (`support-engineer-interview-main/app/signup/page.tsx`). The form now:
  - Rejects invalid dates, future dates, and anyone younger than 18.
  - Sets the HTML `max` attribute so the picker cannot move past the latest eligible birthday.
- Introduced `dateOfBirthSchema` in `support-engineer-interview-main/server/routers/auth.ts` backed by Zod `superRefine`, mirroring the same logic server-side. Any attempt to submit future/underage dates now fails with descriptive errors even if bypassing the UI.

## Verification
- Manual reasoning: selecting a future date or a date within the last 18 years now raises a validation error on the form. The API rejects the same payload, preventing database insertion.
- Recommended follow-up: add unit tests for the DOB validator or integrate automated end-to-end coverage for critical onboarding rules.

## Lessons Learned / Next Steps
1. Critical onboarding validations must be enforced on both client and server.
2. Future tickets should include automated test coverage to prevent regressions.
